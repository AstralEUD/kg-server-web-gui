# Architecture & Data Flow Diagrams

## 1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         🌐 프론트엔드 (Next.js)                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   Dashboard  │  │Config Editor │  │   Mods UI    │  │ Scenarios UI │ │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘ │
│         │                 │                 │                 │          │
│         └─────────────────┼─────────────────┼─────────────────┘          │
│                           │ REST + WebSocket                              │
└───────────────────────────┼────────────────────────────────────────────────┘
                            │
                   ┌────────▼────────┐
                   │ 📦 백엔드(Go)    │
        ┌──────────┴────────┬────────┴──────────┐
        │                   │                   │
    ┌───▼────┐          ┌───▼────┐         ┌───▼────┐
    │REST API │          │Job Queue│       │WebSocket│
    │Handlers │          │(Redis)  │       │Hub      │
    └────┬────┘          └────┬────┘       └────┬────┘
         │                    │                  │
    ┌────▼─────────────────────▼──────────────────▼────┐
    │ 💼 Business Logic (Services)                      │
    │ ├─ profile_service                              │
    │ ├─ config_service (validation, backup)          │
    │ ├─ mod_service (dependency analysis)            │
    │ ├─ scenario_service (-listScenarios)            │
    │ ├─ job_service (Job Worker)                     │
    │ └─ workshop_service (Steam scraping)            │
    └────┬──────────────────────────────────────────────┘
         │
    ┌────┴─────────────────┬───────────────────────────┐
    │                      │                           │
┌───▼────┐            ┌───▼────┐              ┌───▼─────┐
│PostgreSQL           │ kgagent                 │ File I/O│
│DB                   │ (gRPC)                  │ Monitor │
│                     │                         │         │
│ - Profiles          │ • Mod Scan              │ - Watch │
│ - Configs           │ • List Scenarios        │   next.json
│ - Mods              │ • Process Control       │         │
│ - Scenarios         │ • Server.json R/W       │         │
│ - Jobs              │ • SteamCMD Exec         │         │
│ - Users             │ • Backup/Restore        │         │
│ - AuditLogs         │                         │         │
└───────────┬─────────┴───────────┬─────────────┴─────────┘
            │                     │
            └──────────┬──────────┘
                       │
        ┌──────────────▼───────────────┐
        │  🖥️ Windows Server Machine    │
        │                              │
        │  ArmaReforgerServer.exe       │
        │  C:\saves\addons\*            │
        │  C:\...\server.json           │
        │                              │
        │  Reforger Dedicated Server    │
        └──────────────────────────────┘
```

---

## 2. 미션 번호 전환 흐름(`!kgmission 13`)

```
┌────────────────────┐
│ [1] 인게임 채팅   │
│ "!kgmission 13"   │
└────────┬───────────┘
         │
    ┌────▼──────────────────┐
    │[2] 서버 모드 처리      │
    │ • 권한 검증            │
    │ • 번호 범위 확인       │
    │ → 번호 유효 여부       │
    └────┬────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[3] next.json에 요청 기록         │
    │ {                                │
    │   "requestedMission": "13",      │
    │   "requestedBy": "player_id",   │
    │   "requestedVia": "ingame",      │
    │   "requestedAt": "2026-01-10..." │
    │ }                                │
    └────┬──────────────────────────────┘
         │
    ┌────▼──────────────────────┐
    │[4] kgagent 감시           │
    │ (또는 백엔드 폴링)        │
    └────┬───────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[5] Go 백엔드 검증                  │
    │ • scenarios DB에서 번호 13 조회   │
    │ • scenarioId 추출                  │
    │ • 필수 mods 확인                   │
    │ → Job 생성(mission_change)        │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[6] Job Worker 실행(순열)           │
    │                                   │
    │ Step A: server.json 읽기          │
    │ Step B: game.scenarioId 교체      │
    │ Step C: game.mods 병합(필수 모드) │
    │ Step D: 백업 생성                  │
    │ Step E: server.json 적용          │
    │ Step F: 서버 프로세스 재시작      │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[7] kgagent 처리                    │
    │ • ps aux로 프로세스 확인           │
    │ • kill SIGTERM (graceful)         │
    │ • ArmaReforgerServer.exe 재시작   │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[8] WebSocket 브로드캐스트         │
    │ {                                │
    │   "type": "job_status",          │
    │   "jobId": "...",                │
    │   "status": "success",           │
    │   "missionNumber": 13,           │
    │   "scenarioId": "...",           │
    │   "timestamp": "2026-01-10..."   │
    │ }                                │
    └────┬───────────────────────────────┘
         │
    ┌────▼─────────────────────────────────┐
    │[9] 프론트 업데이트                    │
    │ • "현재 미션: 13" 표시               │
    │ • Job 로그 표시                       │
    │ • 감시로그 기록                       │
    └──────────────────────────────────────┘
```

---

## 3. 모드 의존성 자동 포함 흐름

```
┌─────────────────────────────────┐
│[1] 사용자 선택(프론트)           │
│ "ACE All-in-One" 추가            │
└────────┬────────────────────────┘
         │
    ┌────▼───────────────────────────┐
    │[2] Go 백엔드 조회              │
    │ GET /api/mods/65AD7BE594439A52/dependencies
    └────┬──────────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[3] 4가지 정보원 병합             │
    │                                 │
    │ A) addon.gproj 파일(로컬)       │
    │    → "Dependencies" 필드 파싱   │
    │                                 │
    │ B) Workshop API(웹 스크래핑)    │
    │    → 요구 사항 섹션 파싱        │
    │                                 │
    │ C) 서버 설정(server.json)       │
    │    → 이미 포함된 mods 확인      │
    │                                 │
    │ D) DB 캐시                      │
    │    → 의존성 그래프(미리 계산)  │
    └────┬────────────────────────────┘
         │
    ┌────▼────────────────────────────────┐
    │[4] 의존성 트리 구성                  │
    │                                     │
    │ ACE All-in-One                      │
    │  ├─ ACE Core (필수)                 │
    │  ├─ ACE Medical (필수)              │
    │  │   ├─ ACE Medical Core (필수)    │
    │  │   └─ ACE Circulation (선택)     │
    │  └─ ACE Explosives (선택)          │
    │                                     │
    │ 변환:                               │
    │ 필수 모드만 수집                    │
    │ [core_id, medical_core_id, ...]    │
    └────┬─────────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[5] 사용자 확인(프론트)             │
    │ "다음 모드도 자동 추가됩니다"      │
    │ • ACE Core                        │
    │ • ACE Medical Core                │
    │ [확인] [취소]                      │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[6] PUT /api/profiles/:id/config   │
    │ {                                 │
    │   "game": {                       │
    │     "mods": [                     │
    │       {"modId": "65AD7BE594439A52"},
    │       {"modId": "65AD7D0D9941A380"},
    │       ...                         │
    │     ]                             │
    │   }                               │
    │ }                                 │
    └────┬───────────────────────────────┘
         │
    ┌────▼───────────────────────────────┐
    │[7] Job: apply_config              │
    │ (Config Editor와 동일 프로세스)   │
    └────┬──────────────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[8] 완료 알림(WebSocket)          │
    │ • "설정 적용됨"                   │
    │ • 새로운 mods 리스트 표시        │
    │ • 서버 재시작 진행중...         │
    └─────────────────────────────────┘
```

---

## 4. 고아 폴더 정리 흐름

```
┌──────────────────────────────┐
│[1] 사용자가 "고아 폴더 분석" │
│   버튼 클릭                   │
└────────┬─────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[2] kgagent: addons 폴더 스캔     │
    │ • 재귀 스캔 C:\saves\addons\*   │
    │ • addon.gproj 찾기               │
    │ • 각 항목에서 GUID 추출          │
    │                                 │
    │ 결과: {GUID1, GUID2, ...}       │
    └────┬────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[3] Go 백엔드: DB 조회             │
    │ • mods 테이블의 모든 modId       │
    │ • server.json의 game.mods        │
    │                                  │
    │ 설정됨: {GUID1, GUID3, ...}     │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[4] 차집합 계산                      │
    │ orphans = installed - configured  │
    │                                  │
    │ 고아: {GUID5, GUID9, ...}       │
    └────┬───────────────────────────────┘
         │
    ┌────▼───────────────────────────┐
    │[5] 사용자 확인(프론트)          │
    │ 테이블: 고아 폴더 목록           │
    │ • MyMod_GUID5 (120MB)           │
    │ • UnusedAddon_GUID9 (45MB)      │
    │                                 │
    │ 선택 체크박스                     │
    │ [휴지통으로 이동]                │
    └────┬──────────────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[6] 2단계 확인(UI)                │
    │ "정말 삭제할까요?"               │
    │ "자동 영구 삭제: 30일 후"        │
    │                                 │
    │ [확인] [취소]                    │
    └────┬────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[7] Job: cleanup_mods             │
    │ payload: {                       │
    │   "guids": ["GUID5", "GUID9"]   │
    │ }                                │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[8] kgagent 실행                   │
    │ • 각 폴더를 휴지통으로 이동      │
    │   (move → recycle bin)           │
    │                                  │
    │ • 30일 타이머 설정(선택)         │
    │   → 자동 영구 삭제               │
    └────┬───────────────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[9] 완료(WebSocket)               │
    │ • "165MB 정리됨"                 │
    │ • 고아 목록에서 제거            │
    │ • Job 로그 표시                   │
    └─────────────────────────────────┘
```

---

## 5. Config Editor 편집 → 적용 흐름

```
┌──────────────────────────┐
│[1] 사용자 설정 수정      │
│ (JSON 트리 또는 필드)     │
└────────┬─────────────────┘
         │
    ┌────▼────────────────────────┐
    │[2] 클라이언트 검증(선택)    │
    │ • 필드 타입 체크             │
    │ • Enum 범위                  │
    │ • 기본 형식 오류             │
    └────┬───────────────────────────┘
         │
    ┌────▼─────────────────────────────┐
    │[3] "검증" 버튼 클릭             │
    │ POST /api/profiles/:id/config/validate
    │ {"config": {...}}               │
    └────┬──────────────────────────────┘
         │
    ┌────▼─────────────────────────────────┐
    │[4] Go 백엔드 검증                     │
    │                                     │
    │ A) JSON 스키마 검증                 │
    │    • Reforger server.json 스키마  │
    │ B) 비즈니스 로직 검증               │
    │    • game.scenarioId 형식 확인     │
    │      ({GUID}Missions/xxx.conf)    │
    │    • game.mods[].modId 존재 확인  │
    │    • 필수 의존성 확인              │
    │ C) 대소문자 경고                    │
    │    • game.Mods vs game.mods → ⚠️ │
    └────┬──────────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[5] 검증 결과 반환                   │
    │ ✅ 모두 통과 또는               │
    │ ⚠️  경고 목록 또는             │
    │ ❌ 오류 목록                   │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────┐
    │[6] Diff 표시(프론트)          │
    │ 좌측: 현재 server.json        │
    │ 우측: 변경사항                │
    │                              │
    │ 예:                          │
    │ - "scenarioId": "old.conf"   │
    │ + "scenarioId": "new.conf"   │
    └────┬───────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[7] "적용" 버튼 클릭               │
    │ PUT /api/profiles/:id/config/apply
    │ {"config": {...}}                │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────────┐
    │[8] Go 백엔드: Job 생성               │
    │ type = "apply_config"                │
    │ payload = {config}                   │
    │                                      │
    │ DB에 저장 + Job 큐에 추가            │
    └────┬─────────────────────────────────┘
         │
    ┌────▼─────────────────────────────────┐
    │[9] Job Worker 실행(순열)             │
    │                                     │
    │ Step A: 현재 server.json 읽기      │
    │ Step B: 검증(재확인)                │
    │ Step C: 백업 생성                    │
    │         (C:\...\server.json.2026...)│
    │ Step D: 원자적(atomic) 기록         │
    │         (임시 파일 → 이동)          │
    │ Step E: DB에 기록                    │
    │         (ServerConfigs 테이블)      │
    │ Step F: kgagent에 알림               │
    │         "restart_server" 명령       │
    └────┬────────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[10] kgagent: 프로세스 제어        │
    │                                  │
    │ A) ps aux로 PID 찾기             │
    │ B) graceful shutdown:            │
    │    SIGTERM(15) 발송              │
    │ C) 60초 대기                      │
    │ D) 응답 없으면:                  │
    │    SIGKILL(9) 발송               │
    │ E) 새 프로세스 시작              │
    │    ArmaReforgerServer.exe        │
    └────┬───────────────────────────────┘
         │
    ┌────▼────────────────────────────────┐
    │[11] 서버 부팅(Reforger)            │
    │                                    │
    │ • 설정 로드                        │
    │ • 모드 활성화                      │
    │ • 시나리오 로드                    │
    │ • 플레이어 접속 대기              │
    └────┬───────────────────────────────┘
         │
    ┌────▼─────────────────────────────────┐
    │[12] WebSocket 브로드캐스트          │
    │ {                                   │
    │   "type": "job_status",            │
    │   "jobId": "...",                  │
    │   "status": "success",             │
    │   "message": "설정 적용 + 재시작", │
    │   "backupPath": "...",             │
    │   "timestamp": "2026-01-10..."     │
    │ }                                  │
    └────┬────────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[13] 프론트 업데이트              │
    │ • ✅ "적용 완료"                │
    │ • 현재 설정값 새로고침          │
    │ • 백업 목록에 추가              │
    │ • "롤백" 버튼 활성화            │
    │ • 감시로그 기록                 │
    └──────────────────────────────────┘
```

---

## 6. SteamCMD 업데이트 흐름

```
┌────────────────────────────┐
│[1] "업데이트" 버튼(대시보드)│
└────────┬─────────────────────┘
         │
    ┌────▼──────────────────────────┐
    │[2] 확인 대화상자               │
    │ "서버를 중지하고 업데이트?"    │
    │ • 예상 시간: 5-10분           │
    │ • 플레이어 강제 종료          │
    │                              │
    │ [업데이트] [취소]             │
    └────┬───────────────────────────┘
         │
    ┌────▼─────────────────────────┐
    │[3] Job: steamcmd_update      │
    │ payload: {                  │
    │   "validate": true,         │
    │   "force": false            │
    │ }                           │
    └────┬────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[4] Job Worker 실행                 │
    │                                   │
    │ Step A: 서버 프로세스 정지        │
    │ Step B: SteamCMD 명령 구성        │
    │  SteamCMD.exe +login anonymous \  │
    │   +app_update 1874900 validate \  │
    │   +quit                           │
    │ Step C: 백그라운드 실행           │
    │         (진행률 스트림)           │
    └────┬───────────────────────────────┘
         │
    ┌────▼────────────────────────────────┐
    │[5] SteamCMD 실행(kgagent)           │
    │                                    │
    │ • 다운로드 진행률 캡처 + 파싱     │
    │ • 로그: "Downloading..."          │
    │         "Verifying..."            │
    │         "100%"                    │
    │                                    │
    │ 진행률 예시:                      │
    │ ▓▓▓▓▓░░░░░░░ 45%                 │
    └────┬──────────────────────────────┘
         │
    ┌────▼─────────────────────────┐
    │[6] WebSocket 실시간 로그    │
    │ {                           │
    │   "type": "job_log",        │
    │   "jobId": "...",           │
    │   "progress": 0.45,         │
    │   "log": "Downloading..."   │
    │ }                           │
    └────┬────────────────────────────┘
         │
    ┌────▼────────────────────────────┐
    │[7] 프론트: 진행률 표시         │
    │ SteamCMD 업데이트 중...         │
    │ ▓▓▓▓▓░░░░░░░ 45%              │
    │                               │
    │ 로그 스크롤                     │
    │ Downloading...                 │
    │ [로그 복사] [정지]              │
    └────┬───────────────────────────┘
         │
    ┌────▼────────────────────────────────┐
    │[8] SteamCMD 완료                     │
    │ 상태: success                      │
    │                                    │
    │ (실패 시)                          │
    │ 상태: failed                       │
    │ 오류: "Disk space insufficient"  │
    │ 수동 개입 필요                     │
    └────┬───────────────────────────────┘
         │
    ┌────▼──────────────────────────────┐
    │[9] 서버 재시작(자동)              │
    │                                  │
    │ Step A: 파일 검증                │
    │         (크래시 방지)           │
    │ Step B: 프로세스 시작            │
    │ Step C: 부팅 완료 대기          │
    │         (최대 60초)             │
    └────┬───────────────────────────────┘
         │
    ┌────▼───────────────────────────┐
    │[10] 완료(프론트)               │
    │ ✅ "업데이트 완료"             │
    │ • 버전: 1.6.0.95 (이전)        │
    │        → 1.6.1.100 (현재)     │
    │ • 소요 시간: 8분 45초          │
    │ • 감시로그: admin이 업데이트   │
    │ • Job 기록 저장                │
    │                              │
    │ 플레이어 재접속 가능          │
    └──────────────────────────────┘
```

---

## 7. 로컬 에이전트(kgagent) 기능 맵

```
┌──────────────────────────────────────────────────────┐
│                   kgagent (Windows Service)          │
│                                                      │
│  ┌─────────────────────────────────────────────────┐│
│  │ 파일 시스템 접근(로컬 권한)                      ││
│  │                                                 ││
│  │ • Mod Scan                                     ││
│  │   └─ addons/* 재귀 스캔 → addon.gproj 파싱  ││
│  │   └─ GUID, Dependencies, 버전 추출            ││
│  │                                                 ││
│  │ • List Scenarios                               ││
│  │   └─ -listScenarios 파라미터로 실행            ││
│  │   └─ 출력 파싱 → {GUID}Missions/xxx.conf   ││
│  │                                                 ││
│  │ • Config Read/Write                            ││
│  │   └─ server.json 읽기                          ││
│  │   └─ server.json 원자적 쓰기(임시+rename)   ││
│  │   └─ 인코딩: UTF-8, 대소문자 보존             ││
│  │                                                 ││
│  │ • Backup/Restore                               ││
│  │   └─ server.json → server.json.2026-01-10... ││
│  │   └─ 타임스탬프 자동 관리                       ││
│  │   └─ 3개월 보관(설정 가능)                      ││
│  │                                                 ││
│  │ • Cleanup(휴지통)                              ││
│  │   └─ addons/* 삭제                             ││
│  │   └─ 휴지통 폴더 이동(recycle bin)           ││
│  │   └─ 영구 삭제 타이머 설정(선택)              ││
│  └─────────────────────────────────────────────────┘│
│                                                      │
│  ┌─────────────────────────────────────────────────┐│
│  │ 프로세스 제어(로컬 권한)                        ││
│  │                                                 ││
│  │ • Find Running Server                          ││
│  │   └─ ps aux or tasklist로 PID 찾기           ││
│  │   └─ ArmaReforgerServer.exe 여부 확인        ││
│  │                                                 ││
│  │ • Graceful Shutdown                            ││
│  │   └─ SIGTERM(15) 발송 → 60초 대기            ││
│  │   └─ SIGKILL(9) 강제 종료(필요 시)           ││
│  │                                                 ││
│  │ • Start Server                                 ││
│  │   └─ 실행 파일 경로 + 인자 구성               ││
│  │   └─ 환경 변수 설정(필요 시)                   ││
│  │   └─ 백그라운드 프로세스 생성                  ││
│  │                                                 ││
│  │ • Health Check                                 ││
│  │   └─ 포트 수신 대기(기본 2001)               ││
│  │   └─ 콘솔 로그에서 "Ready" 메시지 감지      ││
│  │   └─ 최대 120초 대기                          ││
│  └─────────────────────────────────────────────────┘│
│                                                      │
│  ┌─────────────────────────────────────────────────┐│
│  │ 추가 실행기(External Command)                    ││
│  │                                                 ││
│  │ • SteamCMD                                     ││
│  │   └─ SteamCMD.exe + 인자로 앱 업데이트       ││
│  │   └─ 진행률 캡처(정규표현식 매칭)            ││
│  │   └─ 실패 시 로그 검사                        ││
│  │                                                 ││
│  │ • Disk Space Check                             ││
│  │   └─ 드라이브 용량 체크                        ││
│  │   └─ 부족 시 경고                              ││
│  └─────────────────────────────────────────────────┘│
│                                                      │
│  ┌─────────────────────────────────────────────────┐│
│  │ 백그라운드 감시(Watchers)                       ││
│  │                                                 ││
│  │ • File Watcher(next.json)                      ││
│  │   └─ next.json 변경 감시                       ││
│  │   └─ 변경 시 Go 백엔드에 웹훅 호출           ││
│  │   └─ (또는 백엔드 폴링 지원)                   ││
│  │                                                 ││
│  │ • Process Monitor                              ││
│  │   └─ 서버 프로세스 상태 주기적 체크          ││
│  │   └─ 예기치 않은 종료 감지                    ││
│  │   └─ Go 백엔드에 보고                         ││
│  │                                                 ││
│  │ • Log Tail                                     ││
│  │   └─ 콘솔 로그 파일 tail(실시간)            ││
│  │   └─ WebSocket으로 백엔드에 스트림          ││
│  └─────────────────────────────────────────────────┘│
│                                                      │
│  ┌─────────────────────────────────────────────────┐│
│  │ 통신(Go 백엔드와)                               ││
│  │                                                 ││
│  │ • 수신: REST API 폴링 (또는 gRPC)             ││
│  │   POST http://localhost:9999/api/agent/scan  ││
│  │                                                 ││
│  │ • 송신: 웹훅 또는 SSE                         ││
│  │   POST http://backend:8080/api/agent/report  ││
│  │                                                 ││
│  │ • 인증: Bearer Token (프로필 생성 시 발급)   ││
│  └─────────────────────────────────────────────────┘│
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 8. DB 다이어그램(주요 관계)

```
┌─────────────────┐
│   Users         │
├─────────────────┤
│ id(PK)          │────┐
│ username        │    │
│ email           │    │
│ password_hash   │    │
│ role            │    │
│ created_at      │    │
└─────────────────┘    │
                       │ 1:M (사용자 생성)
                       │
┌──────────────────────▼───────────┐
│   Profiles                        │
├──────────────────────────────────┤
│ id(PK)                           │◄──┐
│ name                             │   │
│ server_json_path                 │   │
│ profile_path                     │   │ 1:M
│ addons_path                      │   │ (profile 참조)
│ is_active                        │   │
│ created_by(FK Users)             │   │
│ created_at                       │   │
└──────────────────────────────────┘   │
         │                              │
         │ 1:M                          │
         ├─────────────────────────┐   │
         │                         │   │
    ┌────▼──────────────┐   ┌─────▼──────────────┐
    │ Scenarios         │   │ ServerConfigs      │
    ├───────────────────┤   ├────────────────────┤
    │ id(PK)            │   │ id(PK)             │
    │ profile_id(FK)◄───┼───┤ profile_id(FK)─┐  │
    │ scenario_id       │   │ config_json    │  │
    │ name              │   │ applied        │  │
    │ mission_number    │   │ backup_path    │  │
    │ required_mods[]   │   │ created_by     │  │
    └───────────────────┘   │ created_at     │  │
                            └────────────────┘  │
         │                           │          │
         │ 1:M (scenario→mods)      │          │
         │                           │          │
    ┌────▼──────────────┐   ┌────────▼──────────┐
    │ Mods              │   │ Jobs              │
    ├───────────────────┤   ├──────────────────┤
    │ id(PK)            │   │ id(PK)           │
    │ mod_id            │   │ profile_id(FK)◄─┤
    │ name              │   │ job_type        │
    │ version           │   │ status          │
    │ is_installed      │   │ payload         │
    │ dependencies[]    │   │ log_lines[]     │
    │ workshop_id       │   │ created_by      │
    │ mod_metadata      │   │ created_at      │
    └───────────────────┘   │ started_at      │
                            │ finished_at     │
         │                  └──────────────────┘
         │                           │
         │ 1:M (mods in config)     │
         │                           │
    ┌────▼──────────────────────────────────────┐
    │ AuditLogs                                  │
    ├────────────────────────────────────────────┤
    │ id(PK)                                    │
    │ user_id(FK Users)                         │
    │ action (config_applied, mod_added, etc)  │
    │ resource_type (config, mod, job)         │
    │ resource_id                               │
    │ old_value(JSONB)                         │
    │ new_value(JSONB)                         │
    │ status (success, failed)                 │
    │ ip_address                                │
    │ created_at                                │
    └────────────────────────────────────────────┘
```

이 다이어그램들이 전체 아키텍처와 데이터 흐름을 명확하게 시각화합니다.
